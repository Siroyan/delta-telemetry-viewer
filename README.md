# Delta Telemetry Viewer

レーシング・車両テレメトリーデータをビジュアライズするためのStreamlitベースのWebアプリケーションです。CSVファイルから速度、GPS位置、ラップ情報などのデータを読み込み、インタラクティブなグラフと地図で表示します。

## 主な機能

- **時系列速度グラフ**: ラップごとに色分けされた速度チャート
- **GPS軌跡マップ**: Plotly Mapboxを使用した走行軌跡の可視化
- **ラップフィルター**: 特定のラップのみを選択して表示
- **タイムゾーン変換**: UTC、JST、その他のタイムゾーンに対応
- **データスムージング**: 移動平均による速度データの平滑化
- **柔軟な列名対応**: 様々な列名規則を自動認識

## 必要環境

- Python 3.8以上
- 必要なパッケージは`requirements.txt`に記載

## インストール

```bash
# 依存パッケージのインストール
pip install -r requirements.txt
```

## 使い方

### アプリケーションの起動

```bash
streamlit run app.py
```

ブラウザで `http://localhost:8501` にアクセスしてください。

### CSVファイルの準備

アプリケーションは以下のデータ列を含むCSVファイルに対応しています：

#### 必須列
- **タイムスタンプ**: 以下のいずれかの形式
  - `timestamp_ms`, `time_ms`, `epoch_ms`, `timestamp`, `time`
  - UNIXエポック（ミリ秒または秒）または ISO 8601形式の文字列

#### オプション列
- **速度**: `speed`, `velocity`, `v`
- **ラップ番号**: `lap_number`, `lap`, `lapno`, `lap_id`
- **GPS座標**:
  - 緯度: `latitude`, `lat`
  - 経度: `longitude`, `lon`, `lng`, `long`
- **その他**: `average_speed`, `total_time_ms`, `lap_time_ms`

**注意**: 列名は大文字・小文字を区別しません。アプリケーションが自動的に認識します。

### CSVファイル例

```csv
timestamp_ms,speed,lap_number,latitude,longitude
1609459200000,45.5,1,35.6812,139.7671
1609459201000,52.3,1,35.6813,139.7672
1609459202000,58.1,1,35.6814,139.7673
```

### 使用手順

1. **CSVファイルのアップロード**: 左サイドバーの「CSV ファイルを選択」からファイルを選択
2. **タイムゾーンの設定**: お好みのタイムゾーンを選択（デフォルト: Asia/Tokyo）
3. **表示オプションの調整**:
   - 移動平均のウィンドウサイズを調整（1-21ポイント）
   - 散布ポイントの表示/非表示を切り替え
4. **ラップの選択**: 表示したいラップ番号を選択
5. **データの確認**: グラフと地図でデータを可視化

### デフォルトCSVファイルの使用

環境変数 `DEFAULT_CSV_PATH` を設定することで、デフォルトのCSVファイルを指定できます：

```bash
export DEFAULT_CSV_PATH="/path/to/your/data.csv"
streamlit run app.py
```

## 開発環境

このプロジェクトはDevcontainer対応です。VS Codeの「Reopen in Container」機能を使用することで、すぐに開発を開始できます。

### Devcontainer環境
- Python 3.12
- 自動的にポート8501が転送されます
- 必要な拡張機能が自動インストールされます

## 技術スタック

- **[Streamlit](https://streamlit.io/)** (v1.50.0): Webアプリケーションフレームワーク
- **[Plotly](https://plotly.com/python/)** (v6.3.1): インタラクティブなグラフ作成
- **[Pandas](https://pandas.pydata.org/)** (v2.3.3): データ処理
- **[NumPy](https://numpy.org/)** (v2.3.4): 数値計算

## ライセンス

このプロジェクトはオープンソースです。

## トラブルシューティング

### CSVファイルが読み込めない
- 列名が正しいか確認してください（大文字・小文字は自動判定されます）
- タイムスタンプがUNIXエポック（ミリ秒または秒）またはISO 8601形式であることを確認してください

### 地図が表示されない
- `latitude`（緯度）と`longitude`（経度）列が存在することを確認してください
- 座標値が有効な範囲（緯度: -90〜90、経度: -180〜180）内であることを確認してください

### グラフが空白
- `speed`列が存在し、有効な数値データが含まれていることを確認してください
- 選択したラップにデータが存在することを確認してください
